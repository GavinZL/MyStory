# MyStory 多语言支持实现完成说明

## 已完成功能

已成功为 MyStory 工程实现中文、英文两种语言版本支持。

## 新增文件列表

### 1. 本地化资源文件

#### 中文本地化
- `/MyStory/Resources/Localizable/zh-Hans.lproj/Localizable.strings` - 中文字符串资源
- `/MyStory/Resources/Localizable/zh-Hans.lproj/InfoPlist.strings` - 中文 Info.plist 本地化

#### 英文本地化
- `/MyStory/Resources/Localizable/en.lproj/Localizable.strings` - 英文字符串资源
- `/MyStory/Resources/Localizable/en.lproj/InfoPlist.strings` - 英文 Info.plist 本地化

### 2. 工具类文件

- `/MyStory/Utils/LocalizationManager.swift` - 语言管理器（单例模式）
- `/MyStory/Utils/String+Localization.swift` - 字符串本地化扩展

### 3. 视图文件

- `/MyStory/Views/Settings/LanguageSettingsView.swift` - 语言设置页面

## 修改文件列表

1. **Info.plist**
   - 添加 `CFBundleLocalizations` 配置支持中英文
   - 修改权限描述为使用本地化

2. **核心视图文件**
   - `RootView.swift` - Tab 标签本地化
   - `TimelineView.swift` - 时间轴页面本地化
   - `StoryEditorView.swift` - 故事编辑器本地化
   - `CategoryView.swift` - 分类视图本地化
   - `CategoryFormView.swift` - 分类表单本地化
   - `CategoryListView.swift` - 分类列表本地化
   - `SettingsView.swift` - 设置页面本地化

3. **ViewModel 文件**
   - `CategoryViewModel.swift` - 分类显示模式本地化

4. **App 入口**
   - `MyStoryApp.swift` - 添加 LocalizationManager 环境对象

## 需要手动操作的步骤

### 在 Xcode 中添加本地化文件到项目

1. **打开 Xcode 项目**
   - 打开 `MyStory.xcodeproj`

2. **添加本地化资源文件**
   - 在项目导航器中，右键点击 `Resources/Localizable` 文件夹
   - 选择 "Add Files to MyStory..."
   - 选择以下文件夹并添加：
     * `zh-Hans.lproj` 文件夹
     * `en.lproj` 文件夹
   - 确保勾选 "Copy items if needed"
   - Target 选择 "MyStory"

3. **添加工具类文件**
   - 右键点击 `Utils` 文件夹
   - 选择 "Add Files to MyStory..."
   - 添加：
     * `LocalizationManager.swift`
     * `String+Localization.swift`

4. **添加视图文件**
   - 右键点击 `Views/Settings` 文件夹
   - 选择 "Add Files to MyStory..."
   - 添加 `LanguageSettingsView.swift`

5. **配置项目本地化**
   - 选中项目根节点（蓝色图标）
   - 在 "Info" 标签页中
   - 找到 "Localizations" 部分
   - 点击 "+" 添加语言：
     * Chinese (Simplified) - zh-Hans
     * English - en
   - 选择需要本地化的资源文件

## 使用说明

### 语言切换

用户可以通过以下路径切换语言：
1. 打开应用
2. 点击底部 Tab 栏的 "设置"
3. 点击 "语言" 选项
4. 选择想要的语言（简体中文 或 English）
5. 点击 "完成"
6. 应用界面会立即切换到所选语言

### 默认语言

应用会在首次启动时：
- 检测系统语言
- 如果是中文系统，默认使用简体中文
- 其他情况默认使用英文

用户选择的语言会保存在 UserDefaults 中，下次启动时会自动使用上次选择的语言。

## 本地化键值说明

所有的本地化字符串都定义在 `Localizable.strings` 文件中，按功能模块分类：

- **Common** - 通用文本（取消、保存、完成等）
- **Tab Bar** - 底部标签栏
- **Timeline** - 时间轴相关
- **Story Editor** - 故事编辑器
- **Category** - 分类管理
- **Settings** - 设置相关
- **Language Options** - 语言选项
- **Permissions** - 权限描述
- **App Info** - 应用信息

## 技术实现

### LocalizationManager

单例模式的语言管理器，负责：
- 语言选择和切换
- 本地化字符串获取
- 语言偏好持久化
- 语言切换通知

### String 扩展

提供便捷的本地化访问方式：
```swift
// 基础用法
let text = "common.cancel".localized

// 带参数
let count = String(format: "category.storyCount".localized, 5)

// 便捷属性
let cancel = String.cancel
```

### 视图中使用

```swift
Text("settings.title".localized)
.navigationTitle("timeline.title".localized)
Button("common.save".localized) { }
```

## 扩展新语言

如需添加更多语言支持：

1. 在 `LocalizationManager.swift` 中添加新的语言枚举：
```swift
enum AppLanguage: String, CaseIterable {
    case chinese = "zh-Hans"
    case english = "en"
    case japanese = "ja"  // 新增
}
```

2. 创建对应的 `.lproj` 文件夹和 `Localizable.strings` 文件

3. 翻译所有字符串键值

4. 在 Xcode 项目中添加新的本地化配置

## 注意事项

1. **新增文本**：添加新的用户可见文本时，务必使用本地化键值，并在两个语言文件中都添加翻译

2. **参数化字符串**：对于包含动态内容的字符串，使用 `String(format:)` 方法

3. **复数形式**：英文和中文的复数规则不同，需要特别注意翻译

4. **文化差异**：注意不同语言的表达习惯和文化差异

## 验证清单

完成 Xcode 配置后，请验证：

- [ ] 应用可以成功编译
- [ ] 在设置页面可以看到语言选项
- [ ] 切换语言后界面文本正确更新
- [ ] Tab 标签、导航标题都正确显示
- [ ] 时间格式根据语言正确显示
- [ ] 权限请求弹窗使用正确的语言

## 完成时间

2025-12-03

## 技术栈

- SwiftUI
- Combine
- UserDefaults
- NSLocalizedString
- Bundle Localization
