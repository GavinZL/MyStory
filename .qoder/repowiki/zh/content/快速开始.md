# 快速开始

<cite>
**本文档引用的文件**
- [ReadMe.md](file://ReadMe.md)
- [QUICKSTART.md](file://script/QUICKSTART.md)
- [MyStoryApp.swift](file://MyStory/MyStoryApp.swift)
- [Info.plist](file://MyStory/Info.plist)
- [project.pbxproj](file://MyStory.xcodeproj/project.pbxproj)
- [CoreDataStack.swift](file://MyStory/Core/Storage/CoreDataStack.swift)
- [AppRouter.swift](file://MyStory/Core/Router/AppRouter.swift)
- [RootView.swift](file://MyStory/Views/RootView.swift)
- [build_appstore.sh](file://script/build_appstore.sh)
- [build_appstore.py](file://script/build_appstore.py)
</cite>

## 目录
1. [简介](#简介)
2. [开发环境要求](#开发环境要求)
3. [项目克隆与配置](#项目克隆与配置)
4. [依赖安装与环境验证](#依赖安装与环境验证)
5. [首次构建与运行](#首次构建与运行)
6. [模拟器配置与真机调试](#模拟器配置与真机调试)
7. [常见问题解决](#常见问题解决)
8. [环境验证方法](#环境验证方法)
9. [后续开发准备](#后续开发准备)

## 简介

MyStory 是一款面向 iOS 平台的个人故事记录应用，采用 SwiftUI + UIKit 混合开发，基于 MVVM 架构模式，集成了 AI 内容增强能力和本地存储功能。项目支持 iOS 16.0+，使用 Swift 5.9+ 开发语言。

## 开发环境要求

### 系统要求
- **操作系统**: macOS 13.0 或更高版本
- **Xcode 版本**: Xcode 15.0 或更高版本
- **iOS 最低支持版本**: iOS 16.0+
- **开发语言**: Swift 5.9+

### 必要开发工具
- Xcode 15.0+
- Xcode 命令行工具
- Python 3.6+ (用于自动化打包脚本)
- Git 版本控制工具

### 项目技术栈
- **架构模式**: MVVM + 路由架构
- **UI框架**: SwiftUI + UIKit 混合开发
- **本地存储**: Core Data
- **AI服务**: 阿里通义千问 API
- **第三方库**: RichTextKit, ZIPFoundation

**章节来源**
- [ReadMe.md](file://ReadMe.md#L6-L12)
- [project.pbxproj](file://MyStory.xcodeproj/project.pbxproj#L494-L498)

## 项目克隆与配置

### 克隆项目
```bash
# 使用 HTTPS 克隆
git clone https://github.com/your-repo/MyStory.git

# 或使用 SSH 克隆
git clone git@github.com:your-repo/MyStory.git
```

### 项目结构概览
```
MyStory/
├── MyStory/                    # 应用源码
│   ├── App/                    # 应用入口
│   ├── Core/                   # 核心层
│   ├── Models/                 # 数据模型
│   ├── Services/               # 业务服务
│   ├── Views/                  # 视图层
│   ├── Components/             # 通用组件
│   ├── Resources/              # 资源文件
│   └── Utils/                  # 工具类
├── MyStory.xcodeproj/          # Xcode 工程文件
└── script/                     # 构建脚本
```

### 初始配置步骤
1. **打开项目**: 双击 `MyStory.xcodeproj` 打开项目
2. **选择目标**: 在 Xcode 左侧选择 `MyStory` 目标
3. **设置团队**: 在 `Signing & Capabilities` 标签中设置开发团队
4. **配置 Bundle Identifier**: 确保 Bundle Identifier 为 `com.lgogo.story`

**章节来源**
- [ReadMe.md](file://ReadMe.md#L14-L66)
- [project.pbxproj](file://MyStory.xcodeproj/project.pbxproj#L644-L646)

## 依赖安装与环境验证

### 自动化依赖安装
项目使用 Swift Package Manager 和 CocoaPods 进行依赖管理。首次打开项目时，Xcode 会自动下载所需的依赖包。

### 手动安装步骤
```bash
# 1. 打开项目目录
cd MyStory

# 2. 检查 Swift 包依赖
swift package resolve

# 3. 更新包依赖
swift package update

# 4. 清理构建缓存
rm -rf ~/Library/Developer/Xcode/iOS\ Device\ Logs/*
```

### 环境验证
```bash
# 验证 Xcode 命令行工具
xcodebuild -version

# 验证 Swift 版本
swift --version

# 验证 Xcode 项目
cd MyStory && xcodebuild -list
```

**章节来源**
- [project.pbxproj](file://MyStory.xcodeproj/project.pbxproj#L511-L514)
- [build_appstore.sh](file://script/build_appstore.sh#L198-L218)

## 首次构建与运行

### 使用 Xcode 构建
1. **打开项目**: 双击 `MyStory.xcodeproj`
2. **选择模拟器**: 在顶部工具栏选择 iOS 模拟器
3. **连接真机**: 连接 iPhone 到 Mac，选择设备为目标
4. **构建项目**: 按 `Cmd + B` 或选择 `Product → Build`

### 使用命令行构建
```bash
# 进入项目根目录
cd MyStory

# 清理构建
xcodebuild clean

# 构建 Debug 版本
xcodebuild -scheme MyStory -configuration Debug -sdk iphonesimulator

# 构建 Release 版本
xcodebuild -scheme MyStory -configuration Release -sdk iphoneos
```

### 首次运行验证
应用启动后应显示以下界面：
- 时间轴页面 (Tab 1)
- 分类页面 (Tab 2)  
- 设置页面 (Tab 3)

**章节来源**
- [MyStoryApp.swift](file://MyStory/MyStoryApp.swift#L21-L29)
- [RootView.swift](file://MyStory/Views/RootView.swift#L10-L35)

## 模拟器配置与真机调试

### 模拟器配置
1. **启动模拟器**: 在 Xcode 中选择 `Xcode → Open Developer Tool → Simulator`
2. **选择设备**: 支持 iPhone 14 Pro Max, iPhone 15 Pro Max 等
3. **设置分辨率**: 推荐使用 1080×1920 分辨率
4. **启用调试**: 在模拟器中启用 `Debug → Simulate Location`

### 真机调试准备
1. **设备要求**: iOS 16.0 或更高版本
2. **开发者模式**: 在设备上启用开发者模式
3. **信任开发者**: 在设备设置中信任开发者证书
4. **USB连接**: 使用原装 USB 线连接 Mac 和 iPhone

### 调试技巧
```bash
# 启用详细日志
xcodebuild -scheme MyStory -configuration Debug -sdk iphonesimulator -quiet

# 查看设备日志
open ~/Library/Logs/com.apple.dt.Xcode/

# 清理模拟器
xcrun simctl erase all
```

**章节来源**
- [Info.plist](file://MyStory/Info.plist#L60-L70)
- [project.pbxproj](file://MyStory.xcodeproj/project.pbxproj#L644-L644)

## 常见问题解决

### 签名相关问题
**问题**: "Provisioning profile XXX does not match the entitlements file"
**解决方案**:
1. 清理项目: `Product → Clean Build Folder`
2. 删除钥匙串中的旧证书: `Keychain Access → My Certificates`
3. 重新登录 Apple ID: `Xcode → Preferences → Accounts`

**问题**: "Code signing failed"
**解决方案**:
1. 检查团队设置: `Signing & Capabilities → Team`
2. 确认 Bundle Identifier: `Identity → Bundle Identifier`
3. 更新 Provisioning Profile: `Signing & Capabilities → Automatically manage signing`

### 依赖下载失败
**问题**: Swift 包下载超时
**解决方案**:
```bash
# 清理包缓存
rm -rf ~/Library/Caches/org.swift.swiftpm
rm -rf ~/Library/Developer/Xcode/iOS\ Device\ Logs/*

# 重新下载
cd MyStory && swift package resolve
```

### Core Data 模型冲突
**问题**: Core Data 模型版本不匹配
**解决方案**:
```swift
// 在 CoreDataStack 初始化时
#if DEBUG
// 强制删除旧数据库（仅用于开发调试）
if let storeURL = description.url {
    try? FileManager.default.removeItem(at: storeURL)
    try? FileManager.default.removeItem(at: URL(fileURLWithPath: storeURL.path + "-wal"))
    try? FileManager.default.removeItem(at: URL(fileURLWithPath: storeURL.path + "-shm"))
}
#endif
```

**章节来源**
- [CoreDataStack.swift](file://MyStory/Core/Storage/CoreDataStack.swift#L16-L24)
- [QUICKSTART.md](file://script/QUICKSTART.md#L88-L121)

## 环境验证方法

### 构建环境检查
```bash
# 检查 Xcode 版本
xcode-select --print-path

# 检查命令行工具
xcrun --find xcodebuild

# 验证 SDK
xcodebuild -version -sdk iphoneos

# 检查 Swift 版本
swift --version
```

### 项目配置验证
```bash
# 验证项目文件
cd MyStory && ls -la

# 检查 Scheme
xcodebuild -list

# 验证 Bundle Identifier
defaults read com.lgogo.story CFBundleIdentifier

# 检查最低系统版本
defaults read com.lgogo.story MinimumOSVersion
```

### 依赖完整性检查
```bash
# 检查 Swift 包
cd MyStory && swift package dump-package

# 验证第三方库
ls -la Pods/Headers/Public/

# 检查资源文件
find . -name "*.xcassets" -type d
```

### 运行时验证
```swift
// 在应用启动时添加验证代码
print("App Bundle ID: \(Bundle.main.bundleIdentifier ?? "Unknown")")
print("iOS Version: \(UIDevice.current.systemVersion)")
print("Device Model: \(UIDevice.current.model)")

// 验证 Core Data
let context = persistentContainer.viewContext
print("Core Data Stack: \(context)")
```

**章节来源**
- [build_appstore.sh](file://script/build_appstore.sh#L194-L218)
- [project.pbxproj](file://MyStory.xcodeproj/project.pbxproj#L644-L644)

## 后续开发准备

### 开发工作流
1. **分支管理**: 使用 Git Flow 管理功能开发
2. **代码规范**: 遵循项目既定的命名和代码风格
3. **单元测试**: 为核心功能编写测试用例
4. **持续集成**: 配置自动化构建和测试

### 性能优化建议
```swift
// 使用 @MainActor 优化主线程性能
@MainActor
func updateUI() {
    // UI 更新逻辑
}

// 使用 @ObservableObject 优化状态管理
@ObservableObject
class ViewModel: ObservableObject {
    @Published var data: [String] = []
}

// 实现懒加载优化内存使用
LazyVGrid {
    ForEach(items, id: \.id) { item in
        ItemView(item: item)
    }
}
```

### 调试工具配置
1. **Xcode 调试器**: 配置断点和观察点
2. **Instruments**: 使用 Time Profiler 分析性能
3. **Console**: 启用详细日志输出
4. **Network**: 监控网络请求

### 发布准备
```bash
# 使用自动化脚本构建发布版本
cd script && ./build_appstore.sh

# 验证 IPA 文件
otool -l build/MyStory_*.ipa

# 测试安装
ios-deploy --bundle build/MyStory_*.ipa
```

通过以上步骤，新开发者可以在最短时间内成功运行 MyStory 项目并开始开发工作。遇到任何问题都可以参考常见问题解决部分或联系项目维护者。